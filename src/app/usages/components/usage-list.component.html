<div class="usage-records-container">
  <cs-top-bar cs-panels>
    <div class="filter-wrapper filter">
      <mat-form-field *ngIf="isAdmin">
        <mat-select
          multiple="true"
          [placeholder]="'VM_PAGE.FILTERS.SELECT_ACCOUNTS' | translate"
          [(ngModel)]="selectedAccountIds"
          (selectionChange)="accountChanged.emit($event.value)"
        >
          <mat-option>
            <ngx-mat-select-search
              [placeholderLabel]="'SELECT_SEARCH.SEARCH' | translate"
              [noEntriesFoundLabel]="'SELECT_SEARCH.NO_MATCH' | translate"
              [ngModel]="accountQuery"
              (ngModelChange)="onAccountQueryChanged($event)"
            >
              <mat-icon ngxMatSelectSearchClear class="mdi-close"></mat-icon>
            </ngx-mat-select-search>
          </mat-option>
          <mat-option *ngFor="let account of accountsFiltered" [value]="account.id">
            {{ account.fullDomain }}{{ account.name }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <cs-search [ngModel]="query" (ngModelChange)="queryChanged.emit($event)"></cs-search>
    </div>
  </cs-top-bar>

  <div class="usage-list">
    <mat-card>
      <mat-card-header>
        <mat-card-title>
          <div class="period-picker">
            <cs-period-picker
              [label]="'EVENT_PAGE.SELECT_DATE' | translate"
              [okLabel]="'COMMON.OK' | translate"
              [locale]="locale"
              [firstDayOfWeek]="firstDayOfWeek"
              [dateTimeFormat]="dateTimeFormatterService.dateTimeFormat"
              [cancelLabel]="'COMMON.CANCEL' | translate"
              [ngModel]="date"
              (changed)="dateChange.emit($event)"
            ></cs-period-picker>
          </div>
        </mat-card-title>
      </mat-card-header>
      <mat-tab-group
        [selectedIndex]="selectedClass"
        (selectedTabChange)="onTabChanged($event.index)"
      >
        <mat-tab *ngFor="let tab of tabs" [label]="tab | translate"></mat-tab>
      </mat-tab-group>
      <div *loading="isLoading">
        <ng-container *ngIf="usages?.length; then usagesTable; else noUsages"></ng-container>
        <ng-template #usagesTable>
          <table mat-table [dataSource]="dataSource">
            <ng-container matColumnDef="account">
              <th mat-header-cell *matHeaderCellDef>{{ 'USAGE_PAGE.ACCOUNT' | translate }}</th>
              <td mat-cell *matCellDef="let element">
                <span [innerHTML]="element.account | highlight: query"></span>
              </td>
            </ng-container>

            <ng-container matColumnDef="usagetype">
              <th mat-header-cell *matHeaderCellDef>{{ 'USAGE_PAGE.TYPE' | translate }}</th>
              <td mat-cell *matCellDef="let element">
                <span [innerHTML]="element.usageTypeName | translate | highlight: query"></span>
              </td>
            </ng-container>

            <ng-container matColumnDef="usagehour">
              <th mat-header-cell *matHeaderCellDef>{{ 'USAGE_PAGE.TIME' | translate }}</th>
              <td mat-cell *matCellDef="let element">
                <span [innerHTML]="rawUsageToString(element.usagehour)"></span>
              </td>
            </ng-container>

            <ng-container matColumnDef="description">
              <th mat-header-cell *matHeaderCellDef>{{ 'USAGE_PAGE.DESCRIPTION' | translate }}</th>
              <td mat-cell *matCellDef="let element">
                <span [innerHTML]="element.description | highlight: query"></span>
              </td>
            </ng-container>

            <tr
              mat-header-row
              *matHeaderRowDef="this.isAdmin ? tableColumnsAdmin : tableColumns"
            ></tr>
            <tr
              mat-row
              *matRowDef="let row; columns: this.isAdmin ? tableColumnsAdmin : tableColumns"
            ></tr>
          </table>
        </ng-template>
        <ng-template #noUsages>
          <div class="usage-list-no-usages" *ngIf="!usages?.length">
            {{ 'EVENT_PAGE.NO_EVENTS' | translate }}
          </div>
        </ng-template>
      </div>
    </mat-card>
  </div>
</div>
