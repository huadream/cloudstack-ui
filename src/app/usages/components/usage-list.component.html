<div class="usage-list-container">
  <cs-top-bar cs-panels>
    <div class="filter-wrapper filter">
      <cs-date-picker
        [label]="'EVENT_PAGE.SELECT_DATE' | translate"
        [okLabel]="'COMMON.OK' | translate"
        [locale]="locale"
        [firstDayOfWeek]="firstDayOfWeek"
        [dateTimeFormat]="dateTimeFormatterService.dateTimeFormat"
        [cancelLabel]="'COMMON.CANCEL' | translate"
        [ngModel]="date"
        (changed)="dateChange.emit($event)"
      ></cs-date-picker>
      <mat-form-field>
        <mat-select
          class="level-selector"
          [ngModel]="selectedLevels"
          (selectionChange)="selectedLevelsChanged.emit($event.value)"
          multiple="true"
          [placeholder]="'EVENT_PAGE.SELECT_LEVELS' | translate"
        >
          <mat-option *ngFor="let level of levels" [value]="level"> {{ level }} </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field>
        <mat-select
          [ngModel]="selectedTypes"
          (selectionChange)="usageTypesChanged.emit($event.value)"
          multiple="true"
          [placeholder]="'EVENT_PAGE.SELECT_TYPES' | translate"
        >
          <mat-option *ngFor="let et of usageTypes" [value]="et"> {{ et }} </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field *ngIf="isAdmin">
        <mat-select
          multiple="true"
          [placeholder]="'VM_PAGE.FILTERS.SELECT_ACCOUNTS' | translate"
          [(ngModel)]="selectedAccountIds"
          (selectionChange)="accountChanged.emit($event.value)"
        >
          <mat-option *ngFor="let account of accounts" [value]="account.id"
            >{{ account.fullDomain }}{{ account.name }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <cs-search [ngModel]="query" (ngModelChange)="queryChanged.emit($event)"></cs-search>
    </div>
  </cs-top-bar>

  <div class="usage-list" *loading="isLoading">
    <mat-card>
      <mat-card-header>
        <mat-card-title>2019-2010</mat-card-title>
      </mat-card-header>
      <mat-tab-group (selectedTabChange)="onTabChanged($event.index)">
        <mat-tab label="All"></mat-tab>
        <mat-tab label="Instance"></mat-tab>
        <mat-tab label="Volume"></mat-tab>
        <mat-tab label="Network"></mat-tab>
        <mat-tab label="Image"></mat-tab>
        <mat-tab label="Other"></mat-tab>
      </mat-tab-group>
      <ng-container *ngIf="usages?.length; then usagesTable; else noUsages"></ng-container>
      <ng-template #usagesTable>
        <table mat-table [dataSource]="dataSource">
          <ng-container matColumnDef="account">
            <th mat-header-cell *matHeaderCellDef>{{ 'USAGE_PAGE.ACCOUNT' | translate }}</th>
            <td mat-cell *matCellDef="let element">
              <span [innerHTML]="element.account | highlight: query"></span>
            </td>
          </ng-container>

          <ng-container matColumnDef="usagetype">
            <th mat-header-cell *matHeaderCellDef>{{ 'USAGE_PAGE.TYPE' | translate }}</th>
            <td mat-cell *matCellDef="let element">
              <span [innerHTML]="element.usageTypeName | translate | highlight: query"></span>
            </td>
          </ng-container>

          <ng-container matColumnDef="usagehour">
            <th mat-header-cell *matHeaderCellDef>{{ 'USAGE_PAGE.TYPE' | translate }}</th>
            <td mat-cell *matCellDef="let element">
              <span [innerHTML]="element.usagehour | highlight: query"></span>
            </td>
          </ng-container>

          <ng-container matColumnDef="description">
            <th mat-header-cell *matHeaderCellDef>{{ 'USAGE_PAGE.DESCRIPTION' | translate }}</th>
            <td mat-cell *matCellDef="let element">
              <span [innerHTML]="element.description | highlight: query"></span>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="tableColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: tableColumns"></tr>
        </table>
      </ng-template>
      <ng-template #noUsages>
        <div class="usage-list-no-usages" *ngIf="!usages?.length">
          {{ 'EVENT_PAGE.NO_EVENTS' | translate }}
        </div>
      </ng-template>
    </mat-card>
  </div>
</div>
